<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE concept PUBLIC "-//OASIS//DTD DITA Concept//EN" "concept.dtd">
<concept id="concept_E7FED8A30C8D4CB2ACA383EEE807AC98"> 
  <title>Purchase Events</title> 
  <shortdesc>For the 
	 <wintitle>purchase</wintitle> event, 
	 <keyword>Analytics</keyword> variables are used to capture specific
	 purchase information. The 
	 <wintitle>s.purchaseID</wintitle> variable is used to serialize
	 (de-duplicate) the event. 
  </shortdesc> 
  <prolog> 
	 <metadata> 
		<othermeta name="solution" content="Analytics"/> 
		<othermeta name="topic" content="Developer and implementation"/>
		</metadata>
  </prolog> 
  <conbody> 
	 <p>The 
		<varname>purchaseID</varname> is limited to 20 characters. The 
		<varname>purchaseID</varname> variable serializes all events passed in
		the variable 
		<wintitle>s.events</wintitle>, and overrides any serialization value for
		events. If 
		<varname>purchaseID</varname> is left blank, each instance of the 
		<wintitle>purchase</wintitle> event, even page reloads, is counted. 
	 </p> 
	 <p>If a purchase event is called without a 
		<codeph>purchaseID</codeph>, a unique one is automatically generated
		based on the 
		<codeph>s.products</codeph> and 
		<codeph>s.events</codeph> variables. This automatically generated 
		<codeph>purchaseID</codeph> is stored locally as a cookie value within
		the visitor's browser, and is not sent to any report suite tables. Manually
		defined 
		<codeph>purchaseID</codeph>s on the other hand are sent to a backend
		table within the report suite. The last five purchases made by a visitor (with
		or without 
		<codeph>purchaseID</codeph>) are stored in the local cookie. 
	 </p> 
	 <p>When a visitor makes any purchase, the following checks are made: 
	 </p> 
	 <ul id="ul_117FCED26402468CAFE8701722E535DE"> 
		<li id="li_65677D2BCCCA463CB3886E4DD0CC6E24">Does the 
		  <codeph>purchaseID</codeph> match any of the five cookie values? If so,
		  the image request is considered a duplicate purchase. All conversion variables,
		  including the purchase event, do not appear in reporting. 
		</li> 
		<li id="li_B4AF67B93A254D04AD9EBE33C9985B63">If 
		  <codeph>purchaseID</codeph> is defined, does it match any value in the
		  report suite's backend table? If so, the image request is considered a
		  duplicate purchase. All conversion variables, including the purchase event, do
		  not appear in reporting. 
		</li> 
		<li id="li_AFFBF5856841485686733CDF0E2CBE2A">If the 
		  <codeph>purchaseID</codeph> is unique to both the last 5 stored values
		  in the cookie and the report suite's 
		  <codeph>purchaseID</codeph> table, the image request is unique and
		  included in reporting. If five purchases are already included in the local
		  cookie, the oldest one is overwritten. 
		</li> 
	 </ul> 
	 <p>Specific server-side code can be used to generate the unique number
		(alphanumeric value) embedded in the HTML source. Usually the 
		<wintitle>Order ID</wintitle>, or similar alphanumeric value, is used for
		this purpose. This value should not change if the user refreshes the page. The
		following is a short example (note the 
		<varname>purchaseID</varname> code in bold): 
	 </p> 
	 <section id="section_4FBF138093BD41F59885D2ACC429FF5B"> 
		<title>Syntax</title> 
		<codeblock outputclass="syntax javascript">s.products="Category;ProductName;Qty;total_price [,Category2;ProductName2;Qty;total_price]"
s.state="XX"
s.zip="00000"
<b>s.purchaseID="&lt;%=getPurchaseID()%&gt;"</b>
s.events="purchase"
</codeblock> 
		<p> 
		</p> 
	 </section> 
	 <section id="section_2CBA9B6386A146C0BEF375E1B55687BC"> 
		<title>Examples</title> 
		<codeblock outputclass="syntax javascript">s.products="Footwear;Hiking Boots (1234);1;170.00"
s.state="UT"
s.zip="84097"
s.purchaseID="12341234"
s.events="purchase"</codeblock> 
	 </section> 
	 <section id="section_5A0590B8FD4F40DC89776F55ED9DE668"> 
		<title>Additional Notes</title> 
		<ul id="ul_ECABFB41A46649EA9FBB2BE1E2BAEDB5"> 
		  <li id="li_C58ACAC1E6A341EFA43AA96BBC0A4453"> Be sure to use
			 server-side code to generate the unique identifier for the event. Do not use a
			 JavaScript randomization function to generate a number, which generates unique
			 numbers each time the page is loaded (each 
			 <wintitle>instance</wintitle>/<wintitle>pageview</wintitle> counts). 
		  </li> 
		  <li id="li_5CF7D86401004689902D58340EBC7C9C"> The unique identifiers
			 are applicable to all users across all sessions. Therefore, ensure the
			 identifier is unique across users and sessions. For instance, if the Order ID
			 repeats after 30 days, append the date of the order to make the 
			 <wintitle>Order ID</wintitle> sufficiently unique. 
		  </li> 
		  <li id="li_1D6092289269446F8FEBB9BC7567027A">The serialization value
			 may be alphanumeric values up to 20 characters in length. This is identical to
			 the limitations of 
			 <wintitle>s.purchaseID</wintitle> (replace s. with s_ for G Code). 
		  </li> 
		  <li id="li_362A2961106E46FAA067C60C41549AEC"> The 
			 <wintitle>s.purchaseID</wintitle> variable serializes all events
			 passed in the variable 
			 <wintitle>s.events</wintitle>, and overrides any serialization value
			 for events. Do not use 
			 <wintitle>Event serialization</wintitle> for any events if the 
			 <wintitle>s.purchaseID</wintitle> variable is used on the current
			 page (replace s. with s_ for G Code). 
		  </li> 
		</ul> 
	 </section> 
  </conbody> 
</concept> 
