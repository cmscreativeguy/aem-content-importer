<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE concept PUBLIC "-//OASIS//DTD DITA Concept//EN" "concept.dtd">
<concept id="concept_C8F6394509874DD0A8C0E86D82167272"> 
  <title>Visitor ID Service Implementation</title> 
  <shortdesc>This section contains instructions to deploy the Marketing Cloud
	 Visitor ID service. 
  </shortdesc> 
  <prolog> 
	 <metadata> 
		<othermeta content="Analytics" name="solution"/> </metadata>
  </prolog> 
  <conbody> 
	 <note type="important">Enabling the Visitor ID service in AppMeasurement
		before you have included the Visitor API JavaScript file on all sites
		associated with report suites in your company could result in duplicate visitor
		counts. To avoid duplicate visitor counts, make sure that you understand and
		follow the process described below. 
	 </note> 
	 <p>See 
		<xref href="visid_service.xml#concept_230F8759826E47789EA8DEE08FA09B07"
		 format="dita" scope="local"><?xm-replace_text Visitor ID Service?></xref> for
		details and more information. 
	 </p> 
	 <section id="section_A02F537129A64FFBB690D5738D360C26"> 
		<title>Requirements</title> 
		<p><b>Marketing Cloud</b> 
		</p> 
		<p>Before you implement the Visitor ID service, your company must be
		  provisioned for the Marketing Cloud and master marketing profile. After your
		  company is provisioned, you'll receive a Marketing Cloud organization ID that
		  must be provided during visitor ID service initialization. See 
		  <xref
		  href="https://marketing.adobe.com/resources/help/en_US/mcloud/" format="http"
		  scope="external">Getting Started with Adobe Marketing Cloud</xref>. 
		</p> 
		<p><b>CNAME Not Supported</b> 
		</p> 
		<p>Many customers have configured data collection server CNAME records as
		  part of a 
		  <xref
		  href="https://marketing.adobe.com/resources/help/en_US/whitepapers/first_party_cookies/"
		  format="https" scope="external">first-party cookie implementation</xref>. With
		  the migration to the visitor ID service, the visitor ID is now set using
		  JavaScript, so you no longer need to use a CNAME to enable first party cookies.
		  CNAME implementations are not currently supported, so you'll need to migrate
		  away from a CNAME to use the visitor ID service. For more details, see 
		  <xref
			href="visid_service.xml#concept_230F8759826E47789EA8DEE08FA09B07/section_73D45B1035464F788D2B81EECF83767C"
			format="dita" scope="local"><?xm-replace_text What happens when I migrate away from CNAME??></xref>
		  
		</p> 
		<p>To migrate, see 
		  <xref
			href="visitor_migration.xml#concept_5A1BDA6848504084A1C47B61D91FC761"
			format="dita" scope="local"><?xm-replace_text Visitor Migration?></xref>. 
		</p>
		<p><b>Custom Visitor IDs Not Supported</b>
		</p>
		<p>Setting customer visitor IDs using 
		  <xref href="visitorID.xml#concept_CD273CC915CC4ABD8F52E4209FF9557E"
			format="dita" scope="local"><?xm-replace_text visitorID?></xref> is not
		  supported.
		</p> 
		<p><b>Code Versions</b>
		</p>
		<p>The following library versions are required to support the visitor ID
		  service in the listed solution: 
		</p>
		<ul id="ul_11854F7D76A5475F89E7639BBF05597A"> 
		  <li id="li_D6D4238ABB6E4854946BC6F444463BF0"><b>All Solutions</b>:
			 Marketing Cloud Visitor ID Service 1.2.1 or later 
		  </li>
		  <li id="li_CB9A93E00D024602965E1EB5F4B0BB5E"><b>Analytics</b>:
			 AppMeasurement for JavaScript 1.3 or later 
		  </li> 
		  <li id="li_675610AE4EB24580B229F52B3E4F77ED"><b>Target</b>: Mbox.js 48
			 or later 
		  </li>
		  <li id="li_AC4CD8C09D7E4BF6A5A93F42963708E6"><b>Audience
				management</b>: Data Integration Library (DIL) 4.9 or later
		  </li>
		</ul>
		<p>Additionally, the visitor ID service for Flash requires the following:
		</p>
		<ul id="ul_1A93D7B2863F4168AE2DF2E8CE5B1082">
		  <li id="li_5B09E7B21DD5416CBC2E9E7A64003D68">AIR 3.0+
		  </li>
		  <li id="li_5D8C05B0C9594E2F806C46A57CB2271F">Flex SDK 4.6+
		  </li>
		  <li id="li_28BCB1CC017A44FC9224904771A09CB1">Flash Player 11+
		  </li>
		</ul>
	 </section> 
	 <section id="section_2A80D4F3775341CC8FF8856E5071B17D"> 
		<title>Implementation Steps</title> 
		<table id="table_C63D9274D46B4D8F90CD3EEF36A02902"> 
		  <tgroup cols="3"> 
			 <colspec colnum="1" colname="col1" colwidth="1.00*"/> 
			 <colspec colnum="2" colname="col2" colwidth="2.74*"/> 
			 <colspec colnum="3" colname="col3" colwidth="6.76*"/> 
			 <thead> 
				<row> 
				  <entry colname="col1">Step 
				  </entry> 
				  <entry colname="col2">Task 
				  </entry> 
				  <entry colname="col3">Description 
				  </entry> 
				</row> 
			 </thead> 
			 <tbody> 
				<row> 
				  <entry colname="col1"> 
					 <image href="graphics/step1_icon.png"
					  id="image_9D29F79B4D3444EE89746567C29596BA"></image> 
				  </entry> 
				  <entry colname="col2">Configure the Visitor ID service 
				  </entry> 
				  <entry colname="col3"> 
					 <p>In 
						<codeph>VisitorAPI.js</codeph>, add the following visitor ID
						initialization code at the beginning of the file: 
					 </p> 
					 <codeblock outputclass="syntax javascript">var visitor = new Visitor("INSERT-MCORG-ID-HERE"[,"INSERT-NAMESPACE-HERE"]);
visitor.trackingServer = "INSERT-TRACKING-SERVER-HERE"; // same as s.trackingServer
visitor.trackingServerSecure = "INSERT-SECURE-TRACKING-SERVER-HERE"; //same as s.trackingServerSecure
/*
 ============== DO NOT ALTER ANYTHING BELOW THIS LINE ! ============
</codeblock> 
					 <ul id="ul_769BA118CC244308A805079C2CBECC12"> 
						<li
						 id="li_D366EBDE24CB433EA523DB228CB2FAF1"><codeph>"INSERT-MCORG-ID-HERE"</codeph>
						  - (Required) This ID is sent to your administrator when your company is
						  provisioned for the Adobe Marketing Cloud.
						</li>
						<li
						 id="li_0E8AF71215784D94B8FDC7EB2DD71716"><codeph>[,"INSERT-NAMESPACE-HERE"]</codeph>
						  - (Optional) If you have deployed version 1.1 or earlier of the Visitor ID
						  service using your Analytics namespace, you must include this line to migrate
						  existing users. If you are deploying the visitor ID service for the first time,
						  do not include this value. This value must match the namespace used by your
						  previous deployment. 
						</li> 
					 </ul> 
					 <p> 
					 </p> 
				  </entry> 
				</row> 
				<row> 
				  <entry colname="col1"> 
					 <image href="graphics/step2_icon.png"
					  id="image_DDF49C4E1A55408993B8A0CFBF7CCE85"></image> 
				  </entry> 
				  <entry colname="col2">Distribute 
					 <codeph>VisitorAPI.js</codeph> 
				  </entry> 
				  <entry colname="col3"> 
					 <p>This file should be deployed to your site and then
						referenced in the 
						<codeph>&lt;head&gt;</codeph> or 
						<codeph>&lt;body&gt;</codeph> tag on each page. 
						<codeph>VisitorAPI.js</codeph> must execute before
						appMeasurement for JavaScript and other Adobe Marketing Cloud libraries and
						page code, so place it higher on the page. 
					 </p> 
					 <p>If you are deploying a tag that must appear in the 
						<codeph>&lt;head&gt;</codeph> tag, you must also deploy 
						<codeph>VisitorAPI.js</codeph> in the 
						<codeph>&lt;head&gt;</codeph> tag so that it appears before
						other solution tags. 
					 </p> 
					 <p> 
						<xref
						 href="impl_visid_service.xml#concept_C8F6394509874DD0A8C0E86D82167272/section_5CE74E0BA5BD436D8BAF5355C96A5BBA"
						 format="dita" scope="local"> <?xm-replace_text Can I add VisitorAPI.js to my AppMeasurement.js file??>
						</xref> 
					 </p> 
				  </entry> 
				</row> 
				<row> 
				  <entry colname="col1"> 
					 <image href="graphics/step3_icon.png"
					  id="image_97A0BC4ACE8B43DD9C12DFAC401AD47F"></image> 
				  </entry> 
				  <entry colname="col2">Set a custom prop in 
					 <codeph>AppMeasurement.js</codeph> to measure coverage 
				  </entry> 
				  <entry colname="col3"> 
					 <p>(Recommended) Add the following to a custom prop in your
						implementation: 
					 </p> 
					 <codeblock outputclass="syntax javascript">s.prop1 = (typeof(Visitor) != "undefined" ? "VisitorAPI Present" : "VisitorAPI Missing");</codeblock> 
					 <p>You can then view the prop report to see what percentage of
						your pages are referencing 
						<codeph>VisitorAPI.js</codeph>. After you have the correct
						coverage, continue to the next step. 
					 </p> 
					 <p>It is essential that you activate the visitor ID service on
						all sites at the same time to ensure current visitors are identified correctly.
						
					 </p> 
				  </entry> 
				</row> 
				<row> 
				  <entry colname="col1"> 
					 <image href="graphics/step4_icon.png"
					  id="image_CFFC7D2B4AD24382BC91C356D9B9BFC5"></image> 
				  </entry> 
				  <entry colname="col2">Enable the Visitor ID service in
					 AppMeasurement 
				  </entry> 
				  <entry colname="col3"> 
					 <p>In 
						<codeph>AppMeasurement.js</codeph>, add the following code to
						start using the new Visitor ID service: 
					 </p> 
					 <codeblock outputclass="syntax javascript">s.visitor = Visitor.getInstance("INSERT-MCORG-ID-HERE"[,"INSERT-NAMESPACE-HERE"]);</codeblock> 
					 <p>This line can be inserted anywhere above the core
						AppMeasurement code before any tracking calls are made. 
					 </p> 
				  </entry> 
				</row> 
				<row> 
				  <entry colname="col1"> 
					 <image href="graphics/step5_icon.png"
					  id="image_C096B8C287DB4F588608245D09552241"></image> 
				  </entry> 
				  <entry colname="col2">Test the visitor ID service 
				  </entry> 
				  <entry colname="col3"> 
					 <p>You can verify that the visitor ID service is in use by
						checking for the 
						<codeph>mid</codeph> parameter using 
						<xref
						 href="debugger.xml#concept_B26FFE005EDD4E0FACB3117AE3E95AA2" format="dita"
						 scope="local"><?xm-replace_text Adobe Debugger?></xref>. 
					 </p> 
					 <p>You can also check that the 
						<codeph>AMCV_###@xxx@AdobeOrg</codeph> cookie is set on the
						domain where your page is hosted. 
					 </p> 
					 <note>The visitor ID service does not work on 
						<codeph>http://localhost</codeph>, you must use 
						<codeph>http://127.0.0.1</codeph> when testing. 
					 </note> 
				  </entry> 
				</row> 
				<row> 
				  <entry colname="col1"> 
					 <image href="graphics/step6_icon.png"
					  id="image_5E85257CE0894F8DACB439FF02F00BC1"></image> 
				  </entry> 
				  <entry colname="col2">Migrate from your CNAME to *.omtrdc.net
					 (<xref href="https://marketing.adobe.com/resources/help/en_US/whitepapers/rdc/"
					 format="https" scope="external">RDC</xref>) or *.2o7.net. 
				  </entry> 
				  <entry colname="col3"> 
					 <p>Many customers have configured data collection server CNAME
						records as part of a 
						<xref
						 href="https://marketing.adobe.com/resources/help/en_US/whitepapers/first_party_cookies/"
						 format="https" scope="external">first-party cookie implementation</xref>. This
						lets Adobe data collection servers set first party cookies to identify unique
						visitors. 
					 </p> 
					 <p>With the migration to the visitor ID service, the visitor ID
						is now set using JavaScript, so you no longer need to use a CNAME to enable
						first party cookies. CNAME implementations are not currently supported by the
						visitor ID service.
					 </p> 
					 <p>As a result of this change, cross-domain activity will not
						be connected for Safari and other browsers that block third party cookies.
						Those users will be seen as a separate visitor when they cross domains. 
					 </p> 
					 <p>For more details, see 
						<xref
						 href="visid_service.xml#concept_230F8759826E47789EA8DEE08FA09B07/section_73D45B1035464F788D2B81EECF83767C"
						 format="dita" scope="local"><?xm-replace_text What happens when I migrate away from CNAME??></xref>
						
					 </p> 
					 <p>To migrate, see 
						<xref
						 href="visitor_migration.xml#concept_5A1BDA6848504084A1C47B61D91FC761"
						 format="dita" scope="local"><?xm-replace_text Visitor Migration?></xref> 
					 </p> 
				  </entry> 
				</row> 
			 </tbody> 
		  </tgroup> 
		</table> 
	 </section> 
	 <section id="section_5CE74E0BA5BD436D8BAF5355C96A5BBA"> 
		<title>Can I add VisitorAPI.js to my AppMeasurement.js file?</title> 
		<p>Yes, as long as your 
		  <codeph>AppMeasurement.js</codeph> file is loaded before all other
		  Marketing Cloud JavaScript tags (such as 
		  <codeph>mbox.js</codeph>). If so, you can paste the contents of the 
		  <codeph>VisitorAPI.js</codeph> file, including the configuration you
		  added in step 1 "Configure the Visitor ID service", and paste it at the
		  beginning of your 
		  <codeph>AppMeasurement.js</codeph> file. Make sure you also enable the
		  service by completing step 4 "Enable the Visitor ID service in AppMeasurement".
		  
		</p> 
		<p>This combined file can be deployed in the 
		  <codeph>&lt;head&gt;</codeph> or 
		  <codeph>&lt;body&gt;</codeph> tag on each page. 
		</p> 
	 </section> 
  </conbody> 
</concept> 
