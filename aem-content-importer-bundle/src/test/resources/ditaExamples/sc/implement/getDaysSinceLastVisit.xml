<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE concept PUBLIC "-//OASIS//DTD DITA Concept//EN" "concept.dtd">
<concept id="concept_E3D0FEC81E1F4987B39CC467F19FFCFF"> 
  <title>getDaysSinceLastVisit</title> 
  <shortdesc>Determines the number of days since a user last visited your site,
	 and captures this information in a Analytics variable. 
  </shortdesc> 
  <prolog> 
	 <metadata> 
		<othermeta name="solution" content="Analytics"/> 
		<othermeta name="topic" content="Developer and implementation"/> 
		<othermeta name="subtopic" content="Plug-ins"/> </metadata>
  </prolog> 
  <conbody> 
	 <p>This return frequency data can be used to answer the following
		questions: 
	 </p> 
	 <ul id="ul_9E320862CCE54F028F1ED79C93C2038F"> 
		<li id="li_7E9209EE732F4A5583EAEEDB0D24C816">How frequently do users
		  revisit my site? 
		</li> 
		<li id="li_F48046B197D249AF9E9CC194DFD114E3">How does return frequency
		  correlate with conversion? Do repeat buyers visit frequently or infrequently? 
		</li> 
		<li id="li_BA8C8833971843F381CCB0C9277A0C62">Do users who click through
		  my campaigns then return frequently? 
		</li> 
	 </ul> 
	 <p>The plug-in can also generate values used for segmentation. For example,
		you can create a segment to view all of the data for only those visits that
		were preceded by 30 or more days of non-visitation by the user. 
	 </p> 
	 <note>The following instructions require you to alter the data collection
		code on your site. This can affect data collection on your site, and should
		only be done by a developer with experience using and implementing 
		<keyword>Analytics</keyword>. 
	 </note> 
	 <section id="section_5600DBB819F143D59527A73BD94418DE"> 
		<title>Plug-in Code and Implementation</title> 
		<p> 
		  <b>CONFIG SECTION</b> 
		</p> 
		<p>No changes required. 
		</p> 
		<p> 
		  <b>Plugin Config</b> 
		</p> 
		<p>Place the following code within the 
		  <codeph>s_doPlugins()</codeph> function, which is located in the area
		  of the 
		  <filepath>s_code.js</filepath> file labeled 
		  <i>Plugin Config</i>. Choose one Custom Traffic (s.prop) variable
		  and/or one Custom Converesion (s.eVar) variable for use in capturing return
		  frequency data. This selection should be a variable that has been enabled using
		  the Admin Console but is not currently in use for any other purpose. The
		  following is given as an example, and should be updated appropriately based on
		  your needs. 
		</p> 
		<codeblock outputclass="syntax javascript">s.prop1=s.getDaysSinceLastVisit(Cookie_Name);</codeblock> 
		<p> 
		  <b>PLUGINS SECTION</b> 
		</p> Add the following code to the area of the 
		<filepath>s_code.js</filepath> file labeled 
		<i>PLUGINS SECTION</i>. Do not make any changes to this portion of the
		plug-in code. 
		<codeblock outputclass="syntax javascript">/*
 * Plugin: Days since last Visit 1.1 - capture time from last visit
 */
s.getDaysSinceLastVisit=new Function("c",""
+"var s=this,e=new Date(),es=new Date(),cval,cval_s,cval_ss,ct=e.getT"
+"ime(),day=24*60*60*1000,f1,f2,f3,f4,f5;e.setTime(ct+3*365*day);es.s"
+"etTime(ct+30*60*1000);f0='Cookies Not Supported';f1='First Visit';f"
+"2='More than 30 days';f3='More than 7 days';f4='Less than 7 days';f"
+"5='Less than 1 day';cval=s.c_r(c);if(cval.length==0){s.c_w(c,ct,e);"
+"s.c_w(c+'_s',f1,es);}else{var d=ct-cval;if(d&gt;30*60*1000){if(d&gt;30*da"
+"y){s.c_w(c,ct,e);s.c_w(c+'_s',f2,es);}else if(d&lt;30*day+1 &amp;&amp; d&gt;7*day"
+"){s.c_w(c,ct,e);s.c_w(c+'_s',f3,es);}else if(d&lt;7*day+1 &amp;&amp; d&gt;day){s."
+"c_w(c,ct,e);s.c_w(c+'_s',f4,es);}else if(d&lt;day+1){s.c_w(c,ct,e);s.c"
+"_w(c+'_s',f5,es);}}else{s.c_w(c,ct,e);cval_ss=s.c_r(c+'_s');s.c_w(c"
+"+'_s',cval_ss,es);}}cval_s=s.c_r(c+'_s');if(cval_s.length==0) retur"
+"n f0;else if(cval_s!=f1&amp;&amp;cval_s!=f2&amp;&amp;cval_s!=f3&amp;&amp;cval_s!=f4&amp;&amp;cval_s"
+"!=f5) return '';else return cval_s;");</codeblock>
		<p><b>Notes</b>
		</p>
		<ul id="ul_90CABD2475AA4F9B85488E48E8BA7B48">
		  <li id="li_4600CC64BFD04AED9C854E983CD1AF2D">Always test plug-in
			 installations extensively to ensure that data collection is as expected before
			 deploying in a production environment. 
		  </li>
		  <li id="li_EB708F17378941C7B367B325D1119051">The plug-in categorizes
			 users by return frequency into the following groups: 
			 <ul id="ul_95FECA879CF84362AAC883B71D3011DE">
				<li id="li_49F8035006AC443CA202EDA348928380">First Visit 
				</li>
				<li id="li_82C6CC94E141455B91CA0A5639B3ECD3">Less than 1 day 
				</li>
				<li id="li_F896BCAF42FF43B8B749337B2C99698F">Less than 7 days 
				</li>
				<li id="li_2DA06EE495B1450C91AC48A62FA989E2">More than 7 days 
				</li>
				<li id="li_249AAEE5E38B4E4F893DD8CD4A208235">More than 30 days 
				</li>
			 </ul>
		  </li>
		  <li id="li_AACBBFDC7FC743918AB1DBA0E52E7F75">This plug-in relies on
			 cookies to flag a user has having visited previously. If the browser does not
			 accept cookies, the plug-in returns a value of 
			 <i>Cookies Not Supported</i>. 
		  </li>
		</ul>
	 </section> 
  </conbody> 
</concept>
