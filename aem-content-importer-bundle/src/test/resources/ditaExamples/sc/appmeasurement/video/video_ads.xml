<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE concept PUBLIC "-//OASIS//DTD DITA Concept//EN" "concept.dtd"[]>
<concept id="concept_045DCEBBB82144309DF95CF3C4A6B6A8">
  <title>VAST Video Ad Tracking</title>
  <shortdesc>AppMeasurement provides support to track ads displayed in videos. 
  </shortdesc>
  <prolog>
    <metadata>
      <keywords>
        <keyword>media</keyword>
        <keyword>milestone</keyword>
        <keyword>sdk</keyword>
        <keyword>video</keyword>
      </keywords>
      <othermeta name="solution" content="Analytics" />
      <othermeta name="topic" content="Developer and implementation" />
    </metadata>
  </prolog>
  <conbody>
    <p>Ads are tracked similar to primary content videos, with additional
		parameters tracked with them to associate them with the primary content in
		which they are embedded. The extra parameters are: 
	 </p>
    <ul id="ul_63DF49D3655F48C59DAA613B9E5AB5AE">
      <li id="li_8F2EC757239D46AE8C7BF082C108596E">Primary content video name -
		  The identifier for the primary content video in which the ad is tracked. 
		</li>
      <li id="li_D80A77A9150E47FC9564FD21D3BC53EB">Ad pod and pos position -
		  The pod and position the ad is which the ad is being played in the primary
		  content video. 
		</li>
      <li id="li_5C4BFFF3B34C49BEA42449D122384E78">Ad CPM - The CPM or
		  encrypted CPM for this ad play 
		</li>
    </ul>
    <p>Otherwise ads are tracked using the same methods used to track videos.
		The Ad ID replaces the video name when tracking ads. 
	 </p>
    <p>This example shows a method of tracking a VAST ad when no ad length is
		available. If the ad length is available, you can remove the manual 
		<codeph>complete</codeph> call and include the length in the call to 
		<codeph>openAd</codeph>. 
	 </p>
    <codeblock outputclass="syntax javascript">//stop primary video
s.Media.stop("My Primary Video", 60) //replace 60 with offset location where ad was displayed
//play the ad
s.Media.openAd("My VAST Ad",-1,"Freewheel","My Primary Video","Preroll",0);
s.Media.play("My VAST Ad",0);
// 30 seconds later or whenever the Freewheel ad player stops playing
s.Media.complete("My VAST Ad",30);
s.Media.stop("My VAST Ad",30);
s.Media.close("My VAST Ad");
//start primary video
s.Media.play("My Primary Video", 60)
</codeblock>
    <table id="table_F4BB8E19A8A84BB48AB347172C22ECA3">
      <tgroup cols="3">
        <colspec colnum="1" colname="col1" colwidth="1.00*" />
        <colspec colnum="2" colname="col2" colwidth="3.72*" />
        <colspec colnum="3" colname="col3" colwidth="6.11*" />
        <thead>
          <row>
            <entry colname="col1">Step 
				</entry>
            <entry colname="col2">Task 
				</entry>
            <entry colname="col3">Description 
				</entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry colname="col1">1 
				</entry>
            <entry colname="col2">Stop the primary content and start the ad. 
				</entry>
            <entry colname="col3">
              <p>Call 
					 <codeph>s.Media.stop("My Primary Video"...)</codeph>, then call
					 
					 <codeph>s.Media.openAd("My VAST Ad"...)</codeph> as show in the
					 code example above. Since the ad length is unknown, 
					 <codeph>-1</codeph> is passed as the length. This means that
					 you will need to manually call complete. 
				  </p>
              <p>In the case where the video ad is an overlay, you can call 
					 <codeph>openAd</codeph> without stopping the primary video. 
				  </p>
            </entry>
          </row>
          <row>
            <entry colname="col1">2 
				</entry>
            <entry colname="col2">Play the ad. 
				</entry>
            <entry colname="col3">
              <codeph>s.Media.play("My VAST Ad",0)</codeph>
            </entry>
          </row>
          <row>
            <entry colname="col1">3 
				</entry>
            <entry colname="col2">When the ad finishes, call complete, then
				  stop. 
				</entry>
            <entry colname="col3">
              <p>Include the ad length as the offset parameter for both calls.
					 Offset represents the seconds into the content where the media event occurs,
					 starting from 0. 
				  </p>
              <p>
                <codeph>s.Media.complete("My VAST Ad",30);</codeph>
              </p>
              <p>
                <codeph>s.Media.stop("My VAST Ad",30);</codeph>
              </p>
            </entry>
          </row>
          <row>
            <entry colname="col1">4 
				</entry>
            <entry colname="col2">Close the ad 
				</entry>
            <entry colname="col3">
              <p>
                <codeph>s.Media.close("My VAST Ad");</codeph>
              </p>
            </entry>
          </row>
          <row>
            <entry colname="col1">5 
				</entry>
            <entry colname="col2">Resume the primary video. 
				</entry>
            <entry colname="col3">
              <codeph>s.Media.play("My Primary Video",60)
					 //replace 60 with the actual offset location where the ad was
					 displayed</codeph>
            </entry>
          </row>
        </tbody>
      </tgroup>
    </table>
    <p>This same process can be used to track any type of ad, it is not
		restricted to ads that follow the VAST standard. 
	 </p>
    <p>See 
		<codeph>openAd</codeph> in 
		<xref href="video_ref_methods.xml#concept_30874334BCB54B6D8A8D49388D7F06FF" format="dita" scope="local"><?xm-replace_text Media Module Methods?></xref> and
		the 
		<xref href="video_ref_variables.xml#concept_338A9CA5EC1F4054B9BD07A5FF4F7DAE/section_1EF7D12D42C744A295330346017A6D67" format="dita" scope="local"><?xm-replace_text Ad Tracking Variables?></xref>. 
	 </p>
    <section id="section_0D6EB6BE57AC4C468273D4B58CAB16C4">
      <title>Additional ContextData Mapping for Ad Tracking</title>
      <p>The following variables must be configured in the 
		  <codeph>s.Media.contextDataMapping</codeph> object to track ad metrics:
		</p>
      <codeblock outputclass="syntax javascript">s.Media.contextDataMapping = {
"a.media.name":"eVar2,prop2",
"a.media.segment":"eVar3",
"a.contentType":"eVar1",
"a.media.timePlayed":"event3",
"a.media.view":"event1",
"a.media.segmentView":"event2",
"a.media.complete":"event7",
"a.media.milestones":{  //optionally replace with trackOffsetMilestones
  	25:"event4",
  	50:"event5",
  	75:"event6"
  }
//ad tracking variables
"a.media.ad.name":"eVar4",
"a.media.ad.pod":"eVar5",
"a.media.ad.podPosition":"eVar6",
"a.media.ad.CPM":"eVar7,prop7",
"a.media.ad.clicked":"event14",
"a.media.ad.segment":"eVar8",
"a.media.ad.timePlayed":"event10",
"a.media.ad.view":"event8",
"a.media.ad.segmentView":"event9",
"a.media.ad.complete":"event14",
"a.media.ad.milestones":{  //optionally replace with trackOffsetMilestones
  	25:"event11",
  	50:"event12",
  	75:"event13"
  }
};</codeblock>
      <table id="table_B969ED67CD444868BE53E38FE45157FB">
        <tgroup cols="3">
          <colspec colnum="1" colname="col1" colwidth="1.00*" />
          <colspec colnum="2" colname="col2" colwidth="1.18*" />
          <colspec colnum="3" colname="col3" colwidth="1.54*" />
          <tbody>
            <row>
              <entry>
                <b> contextData</b>
              </entry>
              <entry>
                <b> Destination</b>
              </entry>
              <entry>
                <b> Description</b>
              </entry>
            </row>
            <row>
              <entry> a.media.ad.name 
				  </entry>
              <entry> eVar w/ full subrelations, visits, and visitors 
				  </entry>
              <entry> This will be the name or ID of the ad 
				  </entry>
            </row>
            <row>
              <entry> a.media.ad.pod 
				  </entry>
              <entry> eVar 
				  </entry>
              <entry> The position in the primary content the ad was played 
				  </entry>
            </row>
            <row>
              <entry> a.media.ad.podPosition 
				  </entry>
              <entry> eVar 
				  </entry>
              <entry> The position within the pod where the ad is played 
				  </entry>
            </row>
            <row>
              <entry> a.media.ad.CPM 
				  </entry>
              <entry>
                <b> currency event</b>
              </entry>
              <entry> The CPM or encrypted CPM (prefixed with a "~") that
					 applies to this playback 
				  </entry>
            </row>
            <row>
              <entry> a.media.ad.view 
				  </entry>
              <entry> counter event 
				  </entry>
              <entry> Works the same as a.media.view 
				  </entry>
            </row>
            <row>
              <entry> a.media.ad.clicked 
				  </entry>
              <entry> counter event 
				  </entry>
              <entry> Count the number of clicks for the ad (Media.click calls)
					 
				  </entry>
            </row>
            <row>
              <entry> a.media.ad.timePlayed 
				  </entry>
              <entry> counter event 
				  </entry>
              <entry> Works the same as a.media.timePlayed 
				  </entry>
            </row>
            <row>
              <entry> a.media.ad.complete 
				  </entry>
              <entry> counter event 
				  </entry>
              <entry> Works the same as a.media.complete 
				  </entry>
            </row>
            <row>
              <entry> a.media.ad.segment 
				  </entry>
              <entry> eVar 
				  </entry>
              <entry> Works the same as a.media.segment 
				  </entry>
            </row>
            <row>
              <entry> a.media.ad.segmentView 
				  </entry>
              <entry> counter event 
				  </entry>
              <entry> Works the same as a.media.segmentView 
				  </entry>
            </row>
            <row>
              <entry> a.media.ad.milestones 
				  </entry>
              <entry> counter event 
				  </entry>
              <entry> Works the same as a.media.milestones 
				  </entry>
            </row>
            <row>
              <entry> a.media.ad.offsetMilestones 
				  </entry>
              <entry> counter event 
				  </entry>
              <entry> Works the same as a.media.offsetMilestones 
				  </entry>
            </row>
          </tbody>
        </tgroup>
      </table>
    </section>
  </conbody>
</concept>